meta:
  name: "GSM Registration"
  version: "1.0"

actors:
  - id: User
    name: "User"
    references: [User.1, User.2]

read_models:
  - id: DraftUserProfile
    name: "Draft User Profile"

commands:
  - id: RegisterUser
    name: "Register User"
  - id: GenerateOTP
    name: "Generate OTP"
  - id: SendOTP
    name: "Send OTP"
  - id: ResendOTP
    name: "Resend OTP"

policies:
  - id: Policy1
    name: "- email, password and name must be provided\n- email is unique\n- password: 8-16 characters, include number, uppercase, lowercase\n- referral code is optional"
  - id: GenerateOTPProcess
    name: "Generate OTP Process"
  - id: ValidateOTPProcess
    name:"- OTP is a 6- digit string\n- OTP is only valid for 4 minutes"
  - id: SendOTPProcess
    name: "Send OTP Process"
  - id: ResendOTPProcess
    name: "Users can request a new OTP if\nthey do not receive OPT\n- timeout will be reset\n- user cannot request more than\n5 OTPs continuously"

events:
  - id: UserRegistered
    name: "User Registered"
  - id: RegisterOTPGenerated
    name: "Register OTP Generated"
  - id: ResendOTPGenerated
    name: "Resend OTP Generated"
  - id: RegisterOTPSent
    name: "Register OTP Sent"

external_systems: 
  - id: EmailService
    name: "Email Service"

flows:
  - source_id: User.1
    target_id: RegisterUser
  - source_id: RegisterUser
    target_id: Policy1
  - source_id: Policy1
    target_id: UserRegistered
  - source_id: UserRegistered
    target_id: DraftUserProfile
  - source_id: DraftUserProfile
    target_id: User.2
  - source_id: User.2
    target_id: ResendOTP
  - source_id: ResendOTP
    target_id: ResendOTPProcess
  - source_id: ResendOTPProcess
    target_id: ResendOTPGenerated
  - source_id: ResendOTPGenerated
    target_id: SendOTPProcess

  - source_id: UserRegistered
    target_id: GenerateOTPProcess
  - source_id: GenerateOTPProcess
    target_id: GenerateOTP
  - source_id: GenerateOTP
    target_id: ValidateOTPProcess
  - source_id: ValidateOTPProcess
    target_id: RegisterOTPGenerated
  - source_id: RegisterOTPGenerated
    target_id: SendOTPProcess

  - source_id: SendOTPProcess
    target_id: SendOTP
  - source_id: SendOTP
    target_id: EmailService
  - source_id: EmailService
    target_id: RegisterOTPSent