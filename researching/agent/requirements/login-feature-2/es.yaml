bounded_context: UserProfileManagement

elements:
  # Login Flow
  - id: user_initiated_login
    type: Event
    connections:
      - to: validate_credentials_policy

  - id: validate_credentials_policy
    type: Policy
    connections: [authenticate_user_command]
    related_elements: [user_credentials_read_model]

  - id: user_credentials_read_model
    type: ReadModel

  - id: authenticate_user_command
    type: Command
    connections: [user_aggregate]
    related_elements: [user_actor]

  - id: user_actor
    type: Actor

  - id: user_aggregate
    type: Aggregate
    connections: [authentication_successful_event, authentication_failed_event]

  - id: authentication_successful_event
    type: Event
    connections: [create_session_policy, redirect_to_dashboard_policy]

  - id: authentication_failed_event
    type: Event
    connections: [display_error_policy]

  # Session Management
  - id: create_session_policy
    type: Policy
    connections: [establish_session_command]

  - id: establish_session_command
    type: Command
    connections: [session_aggregate]

  - id: session_aggregate
    type: Aggregate
    connections: [session_established_event]

  - id: session_established_event
    type: Event
    connections: [load_user_context_policy]

  # Dashboard Redirection
  - id: redirect_to_dashboard_policy
    type: Policy
    connections: [navigate_to_dashboard_command]

  - id: navigate_to_dashboard_command
    type: Command
    connections: [dashboard_system]

  - id: dashboard_system
    type: ExternalSystem
    connections: [dashboard_loaded_event]

  - id: dashboard_loaded_event
    type: Event
    connections: [display_welcome_message_policy]

  - id: display_welcome_message_policy
    type: Policy
    connections: [show_welcome_command]

  - id: show_welcome_command
    type: Command

  # Profile Navigation
  - id: profile_navigation_requested
    type: Event
    connections: [authorize_profile_access_policy]
    vertical_boundary: true

  - id: authorize_profile_access_policy
    type: Policy
    connections: [navigate_to_profile_command]
    related_elements: [session_context_read_model]

  - id: session_context_read_model
    type: ReadModel

  - id: navigate_to_profile_command
    type: Command
    connections: [profile_aggregate]
    related_elements: [authenticated_user_actor]

  - id: authenticated_user_actor
    type: Actor

  - id: profile_aggregate
    type: Aggregate
    connections: [profile_page_loaded_event]

  # Profile Data Loading
  - id: profile_page_loaded_event
    type: Event
    connections: [load_profile_sections_policy]

  - id: load_profile_sections_policy
    type: Policy
    connections:
      [
        fetch_personal_info_command,
        fetch_address_info_command,
        fetch_payment_info_command,
      ]
    related_elements: [profile_sections_read_model]

  - id: profile_sections_read_model
    type: ReadModel

  - id: fetch_personal_info_command
    type: Command
    connections: [personal_info_aggregate]

  - id: fetch_address_info_command
    type: Command
    connections: [address_info_aggregate]

  - id: fetch_payment_info_command
    type: Command
    connections: [payment_info_aggregate]

  # Personal Info Section
  - id: personal_info_aggregate
    type: Aggregate
    connections: [personal_info_loaded_event]

  - id: personal_info_loaded_event
    type: Event
    connections: [render_personal_fields_policy]

  - id: render_personal_fields_policy
    type: Policy
    connections: [display_personal_info_command]
    related_elements: [personal_info_fields_read_model]

  - id: personal_info_fields_read_model
    type: ReadModel

  - id: display_personal_info_command
    type: Command

  # Address Info Section
  - id: address_info_aggregate
    type: Aggregate
    connections: [address_info_loaded_event]

  - id: address_info_loaded_event
    type: Event
    connections: [render_address_fields_policy]

  - id: render_address_fields_policy
    type: Policy
    connections: [display_address_info_command]

  - id: display_address_info_command
    type: Command

  # Payment Info Section
  - id: payment_info_aggregate
    type: Aggregate
    connections: [payment_info_loaded_event]

  - id: payment_info_loaded_event
    type: Event
    connections: [render_payment_fields_policy]

  - id: render_payment_fields_policy
    type: Policy
    connections: [display_payment_info_command]

  - id: display_payment_info_command
    type: Command

  # Complete Profile Display
  - id: all_sections_loaded_event
    type: Event
    connections: [validate_profile_completeness_policy]

  - id: validate_profile_completeness_policy
    type: Policy
    connections: [mark_profile_ready_command]

  - id: mark_profile_ready_command
    type: Command
    connections: [profile_display_complete_event]

  - id: profile_display_complete_event
    type: Event

  # Error Handling
  - id: display_error_policy
    type: Policy
    connections: [show_error_message_command]

  - id: show_error_message_command
    type: Command

  # Context Loading
  - id: load_user_context_policy
    type: Policy
    connections: [cache_user_data_command]

  - id: cache_user_data_command
    type: Command
    connections: [user_context_cached_event]

  - id: user_context_cached_event
    type: Event
