meta:
  name: "Expense–Finance–Approval Core"
  version: "1.0"

flows:
  - name: "Requester Creates and Submits PO"
    elements:
      - id: RM.Dashboard
        name: "Requester PO Dashboard"
        type: read_model
        position: { x: 50, y: 50 }
      - id: A.Requester
        name: "Requester"
        type: actor
        position: { x: 250, y: 50 }
      - id: C.CreatePO
        name: "Create PO"
        type: command
        position: { x: 450, y: 50 }
      - id: P.POCreation
        name: "PO Creation Policy"
        type: policy
        position: { x: 650, y: 50 }
      - id: E.POCreated
        name: "PO Created"
        type: event
        position: { x: 850, y: 50 }
      - id: PO.View
        name: "PO Details"
        type: read_model
        position: { x: 1050, y: 50 }
      - id: C.SubmitForApproval
        name: "Submit for Approval"
        type: command
        position: { x: 450, y: 150 }
      - id: P.ApprovalWorkflow
        name: "Approval Workflow Policy"
        type: policy
        position: { x: 650, y: 150 }
      - id: E.POSubmittedForApproval
        name: "PO Submitted for Approval"
        type: event
        position: { x: 850, y: 150 }
      - id: RM.ApprovalQueue
        name: "Approver PO Queue"
        type: read_model
        position: { x: 1050, y: 150 }
      - id: RM.AuditTrail
        name: "PO Audit Log"
        type: read_model
        position: { x: 1250, y: 150 }

    edges:
      - from: RM.Dashboard
        to: A.Requester
      - from: A.Requester
        to: C.CreatePO
      - from: C.CreatePO
        to: P.POCreation
      - from: P.POCreation
        to: E.POCreated
      - from: E.POCreated
        to: PO.View
      - from: A.Requester
        to: C.SubmitForApproval
      - from: C.SubmitForApproval
        to: P.ApprovalWorkflow
      - from: P.ApprovalWorkflow
        to: E.POSubmittedForApproval
      - from: E.POSubmittedForApproval
        to: RM.ApprovalQueue
      - from: E.POSubmittedForApproval
        to: RM.AuditTrail

  - name: "Approver Reviews PO"
    elements:
      - id: RM.ApprovalQueue
        name: "Approver PO Queue"
        type: read_model
        position: { x: 50, y: 250 }
      - id: A.Approver
        name: "Approver"
        type: actor
        position: { x: 250, y: 250 }
      - id: C.ApprovePO
        name: "Approve PO"
        type: command
        position: { x: 450, y: 250 }
      - id: C.RejectPO
        name: "Reject PO"
        type: command
        position: { x: 450, y: 350 }
      - id: P.ApprovalWorkflow
        name: "Approval Workflow Policy"
        type: policy
        position: { x: 650, y: 250 }
      - id: E.POApproved
        name: "PO Approved"
        type: event
        position: { x: 850, y: 250 }
      - id: E.PORejected
        name: "PO Rejected"
        type: event
        position: { x: 850, y: 350 }
      - id: PO.View
        name: "PO Details"
        type: read_model
        position: { x: 1050, y: 250 }
      - id: RM.AuditTrail
        name: "PO Audit Log"
        type: read_model
        position: { x: 1250, y: 250 }

    edges:
      - from: RM.ApprovalQueue
        to: A.Approver
      - from: A.Approver
        to: C.ApprovePO
      - from: C.ApprovePO
        to: P.ApprovalWorkflow
      - from: P.ApprovalWorkflow
        to: E.POApproved
      - from: E.POApproved
        to: PO.View
      - from: E.POApproved
        to: RM.AuditTrail
      - from: A.Approver
        to: C.RejectPO
      - from: C.RejectPO
        to: P.ApprovalWorkflow
      - from: P.ApprovalWorkflow
        to: E.PORejected
      - from: E.PORejected
        to: PO.View
      - from: E.PORejected
        to: RM.AuditTrail

  - name: "Requester Resubmits Rejected PO"
    elements:
      - id: PO.View
        name: "PO Details"
        type: read_model
        position: { x: 50, y: 450 }
      - id: A.Requester
        name: "Requester"
        type: actor
        position: { x: 250, y: 450 }
      - id: C.ResubmitPO
        name: "Resubmit PO"
        type: command
        position: { x: 450, y: 450 }
      - id: P.ApprovalWorkflow
        name: "Approval Workflow Policy"
        type: policy
        position: { x: 650, y: 450 }
      - id: E.POSubmittedForApproval
        name: "PO Submitted for Approval"
        type: event
        position: { x: 850, y: 450 }
      - id: RM.ApprovalQueue
        name: "Approver PO Queue"
        type: read_model
        position: { x: 1050, y: 450 }

    edges:
      - from: PO.View
        to: A.Requester
      - from: A.Requester
        to: C.ResubmitPO
      - from: C.ResubmitPO
        to: P.ApprovalWorkflow
      - from: P.ApprovalWorkflow
        to: E.POSubmittedForApproval
      - from: E.POSubmittedForApproval
        to: RM.ApprovalQueue