# Property Listing Feature - Database Schema & Architecture

## Database Schema and Project Structure

**Date:** 2025-11-18
**Status:** Planning Phase
**Client:** Property Listing Feature

---

ERD Sequelize:

```ts
const { Sequelize, DataTypes } = require('sequelize');
const sequelize = new Sequelize(process.env.DATABASE_URL);

const Property = sequelize.define('Property', {
  title: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  description: {
    type: DataTypes.TEXT,
    allowNull: true,
  },
  price: {
    type: DataTypes.DECIMAL(10, 2),
    allowNull: false,
  },
  address: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  city: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  state: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  country: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  zip: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  bedrooms: {
    type: DataTypes.INTEGER,
    allowNull: true,
  },
  bathrooms: {
    type: DataTypes.DECIMAL(3, 1),
    allowNull: true,
  },
  sqft: {
    type: DataTypes.INTEGER,
    allowNull: true,
  },
  amenities: {
    type: DataTypes.JSON,
    allowNull: true,
  },
  status: {
    type: DataTypes.ENUM('active', 'inactive', 'pending'),
    defaultValue: 'pending',
  },
  ownerId: {
    type: DataTypes.STRING,
    allowNull: false,
  },
});

const PropertyImage = sequelize.define('PropertyImage', {
  filename: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  url: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  isPrimary: {
    type: DataTypes.BOOLEAN,
    defaultValue: false,
  },
});

// One-to-many relationship
Property.hasMany(PropertyImage, {
  foreignKey: 'propertyId',
  as: 'images',
  onDelete: 'CASCADE'
});
PropertyImage.belongsTo(Property, {
  foreignKey: 'propertyId',
  as: 'property'
});
```

### API Routes Example:

```ts
// GET /api/properties - List properties with pagination and eager loading
const getProperties = async (req, res) => {
  const { page = 1, limit = 10, city, minPrice, maxPrice } = req.query;

  const where = {};
  if (city) where.city = city;
  if (minPrice || maxPrice) {
    where.price = {};
    if (minPrice) where.price[Sequelize.Op.gte] = minPrice;
    if (maxPrice) where.price[Sequelize.Op.lte] = maxPrice;
  }

  const properties = await Property.findAndCountAll({
    where,
    include: [{
      model: PropertyImage,
      as: 'images',
      where: { isPrimary: true },
      required: false
    }],
    limit: parseInt(limit),
    offset: (parseInt(page) - 1) * parseInt(limit),
    order: [['createdAt', 'DESC']]
  });

  res.json({
    properties: properties.rows,
    total: properties.count,
    page: parseInt(page),
    totalPages: Math.ceil(properties.count / limit)
  });
};
```

Project structure:

```
backend/
├── models/
│   ├── Property.js
│   └── PropertyImage.js
├── routes/
│   ├── properties.js
│   └── uploads.js
├── middleware/
├── config/
├── uploads/properties/
└── migrations/

frontend/
├── components/
│   ├── PropertyForm.jsx
│   ├── PropertyList.jsx
│   └── PropertyDetail.jsx
├── pages/
├── hooks/
├── services/
└── styles/
```
