Complete Guide: n8n Server on Raspberry Pi 4 with Neon PostgreSQL and Porkbun DNS

Prerequisites

- Raspberry Pi 4 (4GB+ RAM recommended)
- Raspberry Pi OS (64-bit recommended)
- Domain registered with Porkbun
- Neon PostgreSQL account (https://neon.tech)
- Static IP or dynamic DNS solution
- Router access for port forwarding

---

Part 1: Prepare Raspberry Pi

1.1 Update System

sudo apt update && sudo apt upgrade -y

1.2 Install Node.js 20.x (LTS)

curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

Verify installation:
node --version # Should show v20.x.x
npm --version

1.3 Install Build Dependencies

sudo apt install -y build-essential python3

---

Part 2: Set Up Neon PostgreSQL

2.1 Create Neon Database

1. Go to https://console.neon.tech
2. Create a new project
3. Note your connection string (looks like):
   postgresql://username:password@ep-xxx-xxx-123456.us-east-2.aws.neon.tech/neondb?sslmode=require

2.2 Prepare Database for n8n

Connect using the Neon SQL Editor or psql and create the n8n database:

CREATE DATABASE n8n;

Update your connection string to use the n8n database:
postgresql://username:password@ep-xxx-xxx-123456.us-east-2.aws.neon.tech/n8n?sslmode=require

---

Part 3: Install and Configure n8n

3.1 Create n8n User

sudo useradd -m -s /bin/bash n8n

3.2 Install n8n Globally

sudo npm install -g n8n

3.3 Create Configuration Directory

sudo mkdir -p /home/n8n/.n8n
sudo chown -R n8n:n8n /home/n8n/.n8n

3.4 Create Environment File

sudo nano /home/n8n/.n8n/.env

Add the following (replace with your values):

# Database Configuration (Neon PostgreSQL)

DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=ep-xxx-xxx-123456.us-east-2.aws.neon.tech
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=your_username
DB_POSTGRESDB_PASSWORD=your_password
DB_POSTGRESDB_SSL_ENABLED=true
DB_POSTGRESDB_SSL_REJECT_UNAUTHORIZED=false

# n8n Configuration

N8N_HOST=n8n.yourdomain.com
N8N_PORT=5678
N8N_PROTOCOL=https
WEBHOOK_URL=https://n8n.yourdomain.com/

# Security

N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your_secure_password

# Timezone

GENERIC_TIMEZONE=America/New_York

# Execution Settings

EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168

# Encryption Key (generate with: openssl rand -hex 32)

N8N_ENCRYPTION_KEY=your_generated_32_byte_hex_key

Set permissions:
sudo chmod 600 /home/n8n/.n8n/.env
sudo chown n8n:n8n /home/n8n/.n8n/.env

3.5 Generate Encryption Key

openssl rand -hex 32

Copy this output to N8N_ENCRYPTION_KEY in your .env file.

---

Part 4: Create Systemd Service

4.1 Create Service File

sudo nano /etc/systemd/system/n8n.service

Add:

[Unit]
Description=n8n workflow automation
After=network.target

[Service]
Type=simple
User=n8n
Group=n8n
EnvironmentFile=/home/n8n/.n8n/.env
ExecStart=/usr/bin/n8n start
Restart=always
RestartSec=10
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=n8n

# Hardening

NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=/home/n8n/.n8n

[Install]
WantedBy=multi-user.target

4.2 Enable and Start Service

sudo systemctl daemon-reload
sudo systemctl enable n8n
sudo systemctl start n8n

4.3 Check Status

sudo systemctl status n8n
sudo journalctl -u n8n -f # View logs

---

Part 5: Set Up Reverse Proxy with Caddy

Caddy handles automatic HTTPS certificates from Let's Encrypt.

5.1 Install Caddy

sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy

5.2 Configure Caddy

sudo nano /etc/caddy/Caddyfile

Replace contents with:

n8n.yourdomain.com {
reverse_proxy localhost:5678

      # WebSocket support for n8n
      @websockets {
          header Connection *Upgrade*
          header Upgrade websocket
      }
      reverse_proxy @websockets localhost:5678

}

5.3 Restart Caddy

sudo systemctl restart caddy
sudo systemctl enable caddy

---

Part 6: Configure Porkbun DNS

6.1 Get Your Public IP

curl ifconfig.me

6.2 Configure DNS in Porkbun

1. Log in to https://porkbun.com
2. Go to Domain Management → Select your domain
3. Click DNS
4. Add an A Record:
   ┌──────┬──────┬────────────────┬─────┐
   │ Type │ Host │ Answer │ TTL │
   ├──────┼──────┼────────────────┼─────┤
   │ A │ n8n │ YOUR_PUBLIC_IP │ 600 │
   └──────┴──────┴────────────────┴─────┘
   If using the root domain:
   ┌──────┬──────┬────────────────┬─────┐
   │ Type │ Host │ Answer │ TTL │
   ├──────┼──────┼────────────────┼─────┤
   │ A │ @ │ YOUR_PUBLIC_IP │ 600 │
   └──────┴──────┴────────────────┴─────┘
   6.3 Verify DNS Propagation

Wait 5-10 minutes, then:

nslookup n8n.yourdomain.com

# or

dig n8n.yourdomain.com

---

Part 7: Configure Router Port Forwarding

Access your router admin panel (usually http://192.168.1.1) and forward:
┌───────────────┬───────────────┬──────────┬─────────────────┐
│ External Port │ Internal Port │ Protocol │ Internal IP │
├───────────────┼───────────────┼──────────┼─────────────────┤
│ 80 │ 80 │ TCP │ Raspberry Pi IP │
├───────────────┼───────────────┼──────────┼─────────────────┤
│ 443 │ 443 │ TCP │ Raspberry Pi IP │
└───────────────┴───────────────┴──────────┴─────────────────┘
7.1 Set Static IP for Raspberry Pi

Option A: In your router's DHCP settings, reserve an IP for your Pi's MAC address.

Option B: Configure static IP on Pi:

sudo nano /etc/dhcpcd.conf

Add:

interface eth0
static ip_address=192.168.1.100/24
static routers=192.168.1.1
static domain_name_servers=8.8.8.8 8.8.4.4

Replace IPs with your network configuration.

sudo reboot

---

Part 8: Dynamic DNS (If No Static Public IP)

If your ISP doesn't provide a static IP, use Porkbun's dynamic DNS.

8.1 Get Porkbun API Keys

1. Go to Porkbun → Account → API Access
2. Enable API access
3. Note your API Key and Secret Key

8.2 Create Update Script

sudo nano /usr/local/bin/porkbun-ddns.sh

#!/bin/bash

DOMAIN="yourdomain.com"
SUBDOMAIN="n8n"
API_KEY="pk1_xxxxxxxxxxxxxxxxxxxxxxxx"
SECRET_KEY="sk1_xxxxxxxxxxxxxxxxxxxxxxxx"

CURRENT_IP=$(curl -s ifconfig.me)

curl -s -X POST "https://api.porkbun.com/api/json/v3/dns/editByNameType/$DOMAIN/A/$SUBDOMAIN" \
 -H "Content-Type: application/json" \
 -d "{
\"secretapikey\": \"$SECRET_KEY\",
      \"apikey\": \"$API_KEY\",
\"content\": \"$CURRENT_IP\",
\"ttl\": \"600\"
}"

sudo chmod +x /usr/local/bin/porkbun-ddns.sh

8.3 Schedule with Cron

sudo crontab -e

Add:

_/5 _ \* \* \* /usr/local/bin/porkbun-ddns.sh > /dev/null 2>&1

---

Part 9: Security Hardening

9.1 Configure Firewall

sudo apt install ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

9.2 Enable Fail2Ban

sudo apt install fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

9.3 Keep System Updated

sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades

---

Part 10: Verification and Testing

10.1 Test Local Access

curl http://localhost:5678/healthz

10.2 Test Public Access

Open in browser:
https://n8n.yourdomain.com

You should see the n8n login page with your basic auth prompt.

10.3 Check Database Connection

sudo journalctl -u n8n | grep -i postgres

Look for successful connection messages.

---

Troubleshooting

n8n Won't Start

sudo journalctl -u n8n -n 50 --no-pager

Database Connection Issues

- Verify Neon connection string
- Check SSL settings (Neon requires SSL)
- Test connection manually:
  sudo apt install postgresql-client
  psql "postgresql://user:pass@host/n8n?sslmode=require"

Caddy Certificate Issues

sudo journalctl -u caddy -f

- Ensure ports 80/443 are forwarded
- Verify DNS resolves to your IP

Memory Issues

Monitor memory:
free -h
htop

Add swap if needed:
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

---

Maintenance Commands

# Restart n8n

sudo systemctl restart n8n

# View logs

sudo journalctl -u n8n -f

# Update n8n

sudo npm update -g n8n
sudo systemctl restart n8n

# Backup (credentials and workflows are in PostgreSQL)

# Use Neon's built-in backup features

# Check service status

sudo systemctl status n8n caddy

---

Summary

Your n8n instance should now be:

- Running on Raspberry Pi 4 without Docker
- Connected to Neon PostgreSQL for data persistence
- Accessible at https://n8n.yourdomain.com
- Protected with HTTPS (via Caddy + Let's Encrypt)
- Secured with basic authentication and firewall
