import{r,j as e}from"./index-BzDc3jkz.js";import{o as l}from"./oidc-service-BBNFnDYM.js";function f(){const[n,a]=r.useState(null),[g,c]=r.useState(!0),[d,o]=r.useState(null),[t,x]=r.useState(null),[i,m]=r.useState(!1);r.useEffect(()=>{u()},[]);const u=async()=>{try{console.log("[OIDCLogin] Checking authentication status"),c(!0);const s=await l.getUser();a(s),s?console.log("[OIDCLogin] User is authenticated",{email:s.profile.email,name:s.profile.name}):console.log("[OIDCLogin] User is not authenticated")}catch(s){console.error("[OIDCLogin] Error checking authentication",s),o("Failed to check authentication status")}finally{c(!1)}},b=async()=>{try{console.log("[OIDCLogin] Login button clicked"),o(null),await l.login()}catch(s){console.error("[OIDCLogin] Login error",s),o(s instanceof Error?s.message:"Login failed")}},p=async()=>{try{console.log("[OIDCLogin] Logout button clicked"),o(null),await l.logout()}catch(s){console.error("[OIDCLogin] Logout error",s),o(s instanceof Error?s.message:"Logout failed")}},h=async()=>{try{console.log("[OIDCLogin] Fetching debug info");const s=await l.getDebugInfo();x(s),m(!i)}catch(s){console.error("[OIDCLogin] Error getting debug info",s)}},j=async()=>{try{console.log("[OIDCLogin] Refreshing token"),o(null);const s=await l.renewToken();a(s),console.log("[OIDCLogin] Token refreshed successfully")}catch(s){console.error("[OIDCLogin] Token refresh error",s),o(s instanceof Error?s.message:"Token refresh failed")}};return g?e.jsx("div",{className:"p-4 border rounded-lg bg-gray-50",children:e.jsx("p",{children:"Loading authentication status..."})}):e.jsxs("div",{className:"p-6 border rounded-lg bg-white shadow-sm",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ZITADEL OpenID Connect Login"}),d&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:[e.jsx("strong",{children:"Error:"})," ",d]}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"Authenticated"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",n.profile.name||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",n.profile.email||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",n.profile.sub]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expires at:"})," ",n.expires_at?new Date(n.expires_at*1e3).toLocaleString():"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expired:"})," ",n.expired?"Yes":"No"]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Logout"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Refresh Token"}),e.jsxs("button",{onClick:h,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:[i?"Hide":"Show"," Debug Info"]})]}),i&&t&&e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-300 rounded",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Debug Information"}),e.jsx("pre",{className:"text-xs overflow-auto max-h-96",children:JSON.stringify(t,null,2)})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"You are not logged in."}),e.jsx("button",{onClick:b,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold",children:"Login with ZITADEL"}),e.jsxs("button",{onClick:h,className:"ml-2 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:[i?"Hide":"Show"," Debug Info"]}),i&&t&&e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-300 rounded",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Debug Information"}),e.jsx("pre",{className:"text-xs overflow-auto max-h-96",children:JSON.stringify(t,null,2)})]})]})]})}function w(){return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"ZITADEL OpenID Connect Demo"}),e.jsx("p",{className:"text-lg text-gray-600",children:"This page demonstrates OpenID Connect authentication with ZITADEL"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(f,{})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Configuration"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Authority:"}),e.jsx("span",{className:"col-span-2 font-mono text-xs",children:"https://system-v1-fpms4l.zitadel.cloud"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Client ID:"}),e.jsx("span",{className:"col-span-2 font-mono text-xs",children:"346770541404839766"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Redirect URI:"}),e.jsxs("span",{className:"col-span-2 font-mono text-xs",children:[window.location.origin,"/login/callback"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Scope:"}),e.jsx("span",{className:"col-span-2 font-mono text-xs",children:"openid profile email"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"How It Works"}),e.jsxs("div",{className:"prose max-w-none",children:[e.jsxs("ol",{className:"space-y-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Login:"}),` Click the "Login with ZITADEL" button to initiate the authentication flow. You'll be redirected to ZITADEL's login page.`]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Authentication:"})," Enter your credentials on ZITADEL's secure login page."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Callback:"})," After successful authentication, you'll be redirected back to this application at the callback URL."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Exchange:"})," The callback page processes the authorization code and exchanges it for access tokens."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Session:"})," Your session is stored locally and will be maintained across page refreshes."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Silent Renewal:"})," Tokens are automatically renewed in the background before they expire."]})]}),e.jsx("h3",{className:"text-xl font-bold mt-6 mb-2",children:"Debug Logging"}),e.jsx("p",{className:"text-gray-700",children:"All OIDC operations are logged to the browser console with detailed information. Open your browser's developer tools (F12) and check the Console tab to see:"}),e.jsxs("ul",{className:"space-y-2 mt-2",children:[e.jsx("li",{children:"Authentication flow steps"}),e.jsx("li",{children:"Token information (preview only, not full tokens)"}),e.jsx("li",{children:"User profile data"}),e.jsx("li",{children:"Error details if something goes wrong"}),e.jsx("li",{children:"Silent renewal events"})]}),e.jsx("h3",{className:"text-xl font-bold mt-6 mb-2",children:"Features"}),e.jsxs("ul",{className:"space-y-2 mt-2",children:[e.jsx("li",{children:"Automatic token refresh with silent renewal"}),e.jsx("li",{children:"Comprehensive debug logging"}),e.jsx("li",{children:"Error handling and user-friendly messages"}),e.jsx("li",{children:"Session persistence across page reloads"}),e.jsx("li",{children:"Manual token refresh capability"}),e.jsx("li",{children:"Debug information display"})]})]})]}),e.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Development Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Console Logging:"})," All debug logs are prefixed with [OIDC] for easy filtering"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Debug Info Button:"}),' Click "Show Debug Info" to see detailed configuration and session data']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Session Storage:"})," OIDC data is stored in browser session storage with keys prefixed with 'oidc.'"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Token Preview:"})," For security, only the first 20 characters of tokens are logged"]})]})]})]})})}export{w as default};
